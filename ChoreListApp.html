<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Chore Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Chore Tracker">
    
    <!-- Google Fonts for better cross-platform consistency -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PWA App Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>üåü</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>üåü</text></svg>">
    
    <!-- PWA Manifest for better app-like behavior -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk15IENob3JlIFRyYWNrZXIiLAogICJzaG9ydF9uYW1lIjogIkNob3JlcyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgInRoZW1lX2NvbG9yIjogIiM0Q0FGNTAIICAK Cgl">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', 'Comic Sans MS', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .date {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .timer-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .start-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 25px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: block;
            margin: 0 auto;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }

        .timer-controls {
            margin-top: 10px;
            font-size: 0.8em;
            color: rgba(255,255,255,0.7);
        }

        .timer-bonus {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 10px;
            margin: 10px 0;
            font-size: 1.2em;
            animation: bonus-flash 0.5s ease;
        }

        @keyframes bonus-flash {
            0% { background: rgba(76, 175, 80, 0.8); transform: scale(1.05); }
            100% { background: rgba(76, 175, 80, 0.2); transform: scale(1); }
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .core-title {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .allowance-title {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }

        .chore-item {
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

        .chore-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .chore-item.completed {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            border-color: #4CAF50;
        }

        .chore-item.fully-locked {
            background: #e9ecef !important;
            border-color: #adb5bd !important;
            cursor: not-allowed !important;
            opacity: 0.5 !important;
        }

        .chore-item.fully-locked:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .chore-item.fully-locked .checkbox {
            background: #6c757d !important;
            border-color: #6c757d !important;
            color: white !important;
        }

        .chore-item.fully-locked .chore-text {
            color: #6c757d !important;
            text-decoration: line-through;
        }

        .chore-item.locked {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .chore-item.locked:hover {
            transform: none;
        }

        .chore-item:not(.completed):not(.fully-locked):not(.locked) {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            border-color: #ffc107;
        }

        .parent-mode {
            background: rgba(108, 92, 231, 0.1);
            border: 2px dashed #6c5ce7;
        }

        .parent-check-section {
            margin-top: 20px;
            text-align: center;
            background: rgba(108, 92, 231, 0.1);
            border: 2px dashed #6c5ce7;
            border-radius: 15px;
            padding: 20px;
        }

        .parent-ready-message {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .parent-button {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .parent-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .chore-emoji {
            font-size: 1.5em;
            margin-right: 15px;
            min-width: 40px;
            text-align: center;
        }

        .checkbox {
            width: 40px;
            height: 40px;
            border: 4px solid #ddd;
            border-radius: 10px;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .checkbox.checked {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .checkbox.locked {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .chore-text {
            flex: 1;
            font-size: 1.3em;
            font-weight: bold;
        }

        .parent-checkbox {
            width: 30px;
            height: 30px;
            margin-left: 15px;
            border: 3px solid #6c5ce7;
        }

        .parent-checkbox.checked {
            background: #6c5ce7;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 15px;
            height: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            pointer-events: none;
            z-index: 1000;
            animation: celebrate 1s ease-out;
        }

        @keyframes celebrate {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .unlock-message {
            text-align: center;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .triple-click-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.2em;
            z-index: 1500;
            animation: fade-in-out 2s ease;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .completion-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: white;
            text-align: center;
        }

        .celebration-content {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .celebration-title {
            font-size: 3em;
            margin-bottom: 20px;
            animation: celebration-bounce 1s ease infinite;
        }

        @keyframes celebration-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .reset-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .reset-button {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .reset-button:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .reset-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .reset-dialog {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 400px;
        }

        .reset-dialog h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .reset-dialog p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .reset-dialog-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-reset {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        .cancel-reset {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Landscape/Horizontal Tablet Optimizations */
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-width: 1200px;
            }
            
            .timer-section {
                grid-column: 1 / -1;
                margin-bottom: 15px;
            }
            
            .progress-bar {
                grid-column: 1 / -1;
                margin-bottom: 15px;
            }
            
            .section {
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 2em;
                margin-bottom: 5px;
            }
            
            .timer-display {
                font-size: 2em;
            }
            
            .chore-item {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .section-title {
                font-size: 1.5em;
                padding: 10px;
            }
        }

        /* Better mobile/tablet touch targets */
        @media screen and (max-width: 768px) {
            .chore-item {
                min-height: 60px;
            }
            
            .checkbox {
                min-width: 50px;
                min-height: 50px;
            }
            
            .start-button {
                padding: 25px 50px;
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåü My Chore Tracker üåü</h1>
        <div class="date" id="currentDate"></div>
    </div>

    <div class="container">
        <!-- Timer Section -->
        <div class="timer-section" id="timerSection">
            <button class="start-button" id="startButton" onclick="startTimer()">
                üöÄ Start Chores! üöÄ
            </button>
            
            <div id="timerDisplay" style="display: none;">
                <div class="timer-display" id="timerText" onclick="handleTimerClick()">10:00</div>
                <div class="timer-controls">Tap 3x to pause ‚Ä¢ Tap 5x to reset</div>
                <div id="bonusMessage" class="timer-bonus" style="display: none;"></div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill">0%</div>
        </div>

        <!-- Core Chores Section -->
        <div class="section">
            <div class="section-title core-title" id="coreTitle">
                ‚≠ê Core Chores (Must Do First!) ‚≠ê
            </div>
            <div id="coreChores"></div>
            
            <!-- Parent Check Section for Core Chores -->
            <div id="coreParentSection" class="parent-check-section" style="display: none;">
                <div class="parent-ready-message">
                    üéâ All core chores completed! Ready for parent check! üéâ
                </div>
                <button class="parent-button" onclick="toggleParentMode()">
                    üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Check Mode
                </button>
            </div>
        </div>

        <!-- Allowance Chores Section -->
        <div class="section">
            <div class="section-title allowance-title" id="allowanceTitle">
                üí∞ Allowance Chores üí∞
            </div>
            <div id="allowanceUnlock" class="unlock-message" style="display: none;">
                üéâ Great job! Allowance chores are now unlocked! üéâ
            </div>
            <div id="allowanceChores"></div>
            
            <!-- Parent Check Section for Allowance Chores -->
            <div id="allowanceParentSection" class="parent-check-section" style="display: none;">
                <div class="parent-ready-message">
                    üí∞ Allowance chores completed! Ready for parent check! üí∞
                </div>
                <button class="parent-button" onclick="toggleAllowanceParentMode()">
                    üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Check Allowance
                </button>
            </div>
        </div>

        <!-- Reset Section -->
        <div class="reset-section">
            <button class="reset-button" onclick="showResetDialog()">
                üîÑ Reset Everything
            </button>
            <div style="color: rgba(255,255,255,0.8); font-size: 1em; margin-top: 15px; font-weight: bold;">
                v1.1
            </div>
        </div>
    </div>

    <script>
        // Chore data with emojis
        const choreData = {
            core: [
                { text: "Get dressed", emoji: "üëï" },
                { text: "Brush my teeth", emoji: "ü¶∑" },
                { text: "Brush my hair", emoji: "ü™Æ" },
                { text: "Make my bed", emoji: "üõèÔ∏è" },
                { text: "Clean up bedroom", emoji: "üß∏" }
            ],
            allowance: [
                { text: "Clean up living room toys ($1)", emoji: "üéÆ" },
                { text: "Clean up shoes by front door ($1)", emoji: "üëü" },
                { text: "Read for 20 minutes ($1)", emoji: "üìö" },
                { text: "Help someone in the house ($1)", emoji: "ü§ù" }
            ]
        };

        let choreStatus = JSON.parse(localStorage.getItem('choreStatus')) || {
            core: {},
            allowance: {},
            parentApproval: { core: {}, allowance: {} },
            bonusTimeGiven: { core: {}, allowance: {} }
        };

        // Timer variables
        let timerActive = false;
        let timeRemaining = 0;
        let timerInterval = null;
        let timerClickCount = 0;
        let parentMode = false;
        let allowanceParentMode = false;

        function startTimer() {
            timerActive = true;
            timeRemaining = 10 * 60;
            
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'block';
            
            timerInterval = setInterval(updateTimer, 1000);
            updateTimerDisplay();
        }

        function handleTimerClick() {
            timerClickCount++;
            
            setTimeout(function() {
                if (timerClickCount === 3) {
                    pauseTimer();
                } else if (timerClickCount === 5) {
                    resetTimer();
                }
                timerClickCount = 0;
            }, 1000);
        }

        function pauseTimer() {
            if (timerActive && timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                showTimerMessage("‚è∏Ô∏è Timer Paused! Tap 5x to reset ‚è∏Ô∏è");
            } else if (timerActive && !timerInterval) {
                timerInterval = setInterval(updateTimer, 1000);
                showTimerMessage("‚ñ∂Ô∏è Timer Resumed! ‚ñ∂Ô∏è");
            }
        }

        function resetTimer() {
            if (timerActive) {
                clearInterval(timerInterval);
                timerActive = false;
                timeRemaining = 0;
                
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('timerDisplay').style.display = 'none';
                
                showTimerMessage("üîÑ Timer Reset! Ready to start over üîÑ");
            }
        }

        function updateTimer() {
            if (timeRemaining > 0) {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining === 60) {
                    showTimerMessage("‚ö†Ô∏è Only 1 minute left! Hurry up! ‚ö†Ô∏è");
                } else if (timeRemaining === 30) {
                    showTimerMessage("üö® 30 seconds remaining! üö®");
                }
            } else {
                clearInterval(timerInterval);
                showTimerMessage("‚è∞ Time's up! How did you do? ‚è∞");
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const displayTime = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
            
            document.getElementById('timerText').textContent = displayTime;
        }

        function addBonusTime(type, index) {
            if (timerActive && !choreStatus.bonusTimeGiven[type][index]) {
                timeRemaining += 5 * 60;
                choreStatus.bonusTimeGiven[type][index] = true;
                showTimerMessage("üéâ +5 minutes! Great job! üéâ");
                updateTimerDisplay();
                saveData();
            }
        }

        function showTimerMessage(message) {
            const bonusDiv = document.getElementById('bonusMessage');
            bonusDiv.textContent = message;
            bonusDiv.style.display = 'block';
            
            setTimeout(function() {
                bonusDiv.style.display = 'none';
            }, 3000);
        }

        function checkCoreCompletion() {
            const completedCount = choreData.core.filter(function(_, index) {
                return choreStatus.core[index] && choreStatus.parentApproval.core[index];
            }).length;
            
            if (completedCount === choreData.core.length && timerActive) {
                clearInterval(timerInterval);
                // Return to kid mode when core chores are fully complete
                returnToKidMode();
                showCompletionCelebration();
            }
        }

        function showCompletionCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'completion-celebration';
            celebration.innerHTML = '<div class="celebration-content">' +
                '<div class="celebration-title">üéâ AMAZING! üéâ</div>' +
                '<h2>All core chores completed!</h2>' +
                '<h3>Allowance chores are now unlocked!</h3>' +
                '<p>You finished with time left!</p>' +
                '<button onclick="closeCelebration()" style="margin-top: 20px; padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 15px; background: white; color: #4CAF50; cursor: pointer;">' +
                'Continue to Allowance Chores! üí∞</button>' +
                '</div>';
            
            document.body.appendChild(celebration);
            
            setTimeout(function() {
                if (document.body.contains(celebration)) {
                    document.body.removeChild(celebration);
                }
            }, 10000);
        }

        function closeCelebration() {
            const celebration = document.querySelector('.completion-celebration');
            if (celebration) {
                document.body.removeChild(celebration);
            }
            // Ensure we're in kid mode after closing celebration
            returnToKidMode();
        }

        function showResetDialog() {
            const dialog = document.createElement('div');
            dialog.className = 'reset-warning';
            dialog.id = 'resetDialog';
            
            const dialogContent = document.createElement('div');
            dialogContent.className = 'reset-dialog';
            
            const title = document.createElement('h3');
            title.textContent = '‚ö†Ô∏è Reset Everything?';
            
            const message = document.createElement('p');
            message.textContent = 'This will clear all completed chores, parent approvals, and reset the timer. Are you sure you want to start completely over?';
            
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'reset-dialog-buttons';
            
            const cancelButton = document.createElement('button');
            cancelButton.className = 'cancel-reset';
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = function() {
                closeResetDialog();
            };
            
            const confirmButton = document.createElement('button');
            confirmButton.className = 'confirm-reset';
            confirmButton.textContent = 'Yes, Reset All';
            confirmButton.onclick = function() {
                confirmReset();
            };
            
            buttonContainer.appendChild(cancelButton);
            buttonContainer.appendChild(confirmButton);
            
            dialogContent.appendChild(title);
            dialogContent.appendChild(message);
            dialogContent.appendChild(buttonContainer);
            
            dialog.appendChild(dialogContent);
            document.body.appendChild(dialog);
        }

        function closeResetDialog() {
            const dialog = document.getElementById('resetDialog');
            if (dialog && document.body.contains(dialog)) {
                document.body.removeChild(dialog);
            }
        }

        function confirmReset() {
            // Clear all data
            choreStatus = {
                core: {},
                allowance: {},
                parentApproval: { core: {}, allowance: {} },
                bonusTimeGiven: { core: {}, allowance: {} }
            };
            
            // Reset timer
            timerActive = false;
            timeRemaining = 0;
            parentMode = false;
            allowanceParentMode = false;
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Reset UI
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('timerDisplay').style.display = 'none';
            
            // Save and refresh display
            saveData();
            closeResetDialog();
            renderChores();
            updateProgress();
            
            // Show confirmation
            showTimerMessage("üîÑ Everything reset! Ready to start fresh! üîÑ");
        }

        function showTripleClickWarning() {
            const warning = document.createElement('div');
            warning.className = 'triple-click-warning';
            warning.textContent = '‚ö†Ô∏è Task unlocked for re-checking ‚ö†Ô∏è';
            document.body.appendChild(warning);
            
            setTimeout(function() {
                if (document.body.contains(warning)) {
                    document.body.removeChild(warning);
                }
            }, 2000);
        }

        function initApp() {
            updateDate();
            renderChores();
            updateProgress();
        }

        function updateDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
        }

        function renderChores() {
            renderCoreChores();
            renderAllowanceChores();
            updateModeIndicator();
        }

        function updateModeIndicator() {
            const indicator = document.getElementById('modeIndicator');
            if (!indicator) return; // Safety check - exit if element doesn't exist
            
            if (parentMode) {
                indicator.textContent = 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Check Mode: Core Chores';
                indicator.style.background = 'rgba(108, 92, 231, 0.8)';
                indicator.style.padding = '8px 15px';
                indicator.style.borderRadius = '15px';
            } else if (allowanceParentMode) {
                indicator.textContent = 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Check Mode: Allowance Chores';
                indicator.style.background = 'rgba(76, 175, 80, 0.8)';
                indicator.style.padding = '8px 15px';
                indicator.style.borderRadius = '15px';
            } else {
                indicator.textContent = 'üßí Kid Mode: Check off your chores!';
                indicator.style.background = 'rgba(255, 193, 7, 0.8)';
                indicator.style.padding = '8px 15px';
                indicator.style.borderRadius = '15px';
            }
        }

        function renderCoreChores() {
            const container = document.getElementById('coreChores');
            container.innerHTML = '';

            for (let i = 0; i < choreData.core.length; i++) {
                const choreItem = createChoreElement(choreData.core[i], i, 'core');
                container.appendChild(choreItem);
            }
            
            // Check if all core chores are completed by kids (not necessarily parent-approved yet)
            const allCoreCompleted = choreData.core.every(function(_, index) {
                return choreStatus.core[index];
            });
            
            // Check if all core chores are fully approved and locked
            const allCoreApproved = choreData.core.every(function(_, index) {
                return choreStatus.core[index] && choreStatus.parentApproval.core[index];
            });
            
            const parentSection = document.getElementById('coreParentSection');
            if (allCoreCompleted && !allCoreApproved && !parentMode) {
                parentSection.style.display = 'block';
            } else {
                parentSection.style.display = 'none';
            }
        }

        function renderAllowanceChores() {
            const container = document.getElementById('allowanceChores');
            container.innerHTML = '';
            
            // Only unlock allowance chores if ALL core chores are fully completed and approved
            const coreComplete = areCoreChoresComplete();
            
            if (coreComplete) {
                document.getElementById('allowanceUnlock').style.display = 'block';
            } else {
                document.getElementById('allowanceUnlock').style.display = 'none';
            }

            for (let i = 0; i < choreData.allowance.length; i++) {
                const choreItem = createChoreElement(choreData.allowance[i], i, 'allowance', !coreComplete);
                container.appendChild(choreItem);
            }

            // Check if all allowance chores are completed by kids (not necessarily parent-approved yet)
            const allAllowanceCompleted = choreData.allowance.every(function(_, index) {
                return choreStatus.allowance[index];
            });
            
            // Check if all allowance chores are fully approved and locked
            const allAllowanceApproved = choreData.allowance.every(function(_, index) {
                return choreStatus.allowance[index] && choreStatus.parentApproval.allowance[index];
            });
            
            const allowanceParentSection = document.getElementById('allowanceParentSection');
            if (coreComplete && allAllowanceCompleted && !allAllowanceApproved && !allowanceParentMode) {
                // Show button when all allowance chores are kid-completed but not parent-approved
                allowanceParentSection.style.display = 'block';
            } else {
                allowanceParentSection.style.display = 'none';
            }
        }

        function createChoreElement(chore, index, type, locked) {
            locked = locked || false;
            const choreItem = document.createElement('div');
            choreItem.className = 'chore-item';
            
            const isCompleted = choreStatus[type][index];
            const hasParentApproval = choreStatus.parentApproval[type][index];
            const isFullyLocked = isCompleted && hasParentApproval;
            
            // Set visual state
            if (locked) {
                choreItem.classList.add('locked');
            } else if (isFullyLocked) {
                choreItem.classList.add('fully-locked');
            } else if (isCompleted) {
                choreItem.classList.add('completed');
            }

            if ((parentMode && type === 'core') || (allowanceParentMode && type === 'allowance')) {
                choreItem.classList.add('parent-mode');
            }

            const emojiDiv = document.createElement('div');
            emojiDiv.className = 'chore-emoji';
            emojiDiv.textContent = chore.emoji;

            const checkbox = document.createElement('div');
            checkbox.className = 'checkbox';
            if (isCompleted) {
                checkbox.classList.add('checked');
            }
            if (locked) {
                checkbox.classList.add('locked');
            }
            checkbox.innerHTML = isCompleted ? '‚úì' : '';

            const choreText = document.createElement('div');
            choreText.className = 'chore-text';
            choreText.textContent = chore.text;

            choreItem.appendChild(emojiDiv);
            choreItem.appendChild(checkbox);
            choreItem.appendChild(choreText);

            // Add parent checkbox only in parent mode
            if ((parentMode && type === 'core') || (allowanceParentMode && type === 'allowance')) {
                const parentCheckbox = document.createElement('div');
                parentCheckbox.className = 'checkbox parent-checkbox';
                if (hasParentApproval) {
                    parentCheckbox.classList.add('checked');
                }
                parentCheckbox.innerHTML = hasParentApproval ? '‚úì' : 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶';
                
                parentCheckbox.onclick = function(e) {
                    e.stopPropagation();
                    toggleParentApproval(type, index);
                };
                
                choreItem.appendChild(parentCheckbox);
            }

            // Handle clicking logic - FIXED FOR ALLOWANCE CHORES
            if (!locked && !isFullyLocked) {
                // Check if we're in the wrong parent mode for this chore type
                const inWrongParentMode = (parentMode && type === 'allowance') || (allowanceParentMode && type === 'core');
                
                if (!inWrongParentMode) {
                    // Kids can click any unlocked chore (core or allowance)
                    choreItem.onclick = function() {
                        toggleChore(type, index);
                    };
                }
            } else if (isFullyLocked && type === 'core') {
                // Triple click to unlock fully locked core chores only
                let clickCount = 0;
                choreItem.onclick = function(e) {
                    clickCount++;
                    setTimeout(function() {
                        if (clickCount >= 3) {
                            unlockCoreChore(index);
                            showTripleClickWarning();
                        }
                        clickCount = 0;
                    }, 1000);
                };
            }

            return choreItem;
        }

        function toggleChore(type, index) {
            choreStatus[type][index] = !choreStatus[type][index];
            
            // Auto-start timer when first core chore is clicked
            if (type === 'core' && choreStatus[type][index] && !timerActive) {
                startTimer();
            }
            
            if (choreStatus[type][index]) {
                showCelebration();
            }
            
            saveData();
            renderChores();
            updateProgress();
        }

        function unlockCoreChore(index) {
            // Unlock the specific core chore
            choreStatus.core[index] = false;
            choreStatus.parentApproval.core[index] = false;
            choreStatus.bonusTimeGiven.core[index] = false;
            
            // Exit parent mode if active
            if (parentMode) {
                parentMode = false;
            }
            
            saveData();
            renderChores();
            updateProgress();
        }

        function toggleParentMode() {
            parentMode = !parentMode;
            // When entering core parent mode, exit allowance parent mode
            if (parentMode) {
                allowanceParentMode = false;
            }
            renderChores();
        }

        function toggleAllowanceParentMode() {
            allowanceParentMode = !allowanceParentMode;
            // When entering allowance parent mode, exit core parent mode
            if (allowanceParentMode) {
                parentMode = false;
            }
            renderChores();
        }

        // Function to return to kid mode (exit all parent modes)
        function returnToKidMode() {
            parentMode = false;
            allowanceParentMode = false;
            renderChores();
        }

        function toggleParentApproval(type, index) {
            const wasApproved = choreStatus.parentApproval[type][index];
            choreStatus.parentApproval[type][index] = !choreStatus.parentApproval[type][index];
            
            // Add bonus time only when first approving a core chore
            if (type === 'core' && !wasApproved && choreStatus.parentApproval[type][index] && choreStatus.core[index]) {
                addBonusTime(type, index);
            }
            
            // If parent unchecks, reset the bonus time flag
            if (wasApproved && !choreStatus.parentApproval[type][index]) {
                choreStatus.bonusTimeGiven[type][index] = false;
            }
            
            saveData();
            renderChores();
            updateProgress();
            
            // Check for completion
            if (type === 'core') {
                checkCoreCompletion();
            } else if (type === 'allowance') {
                checkAllowanceCompletion();
            }
        }

        function checkAllowanceCompletion() {
            const completedCount = choreData.allowance.filter(function(_, index) {
                return choreStatus.allowance[index] && choreStatus.parentApproval.allowance[index];
            }).length;
            
            if (completedCount === choreData.allowance.length) {
                // All allowance chores are fully completed!
                returnToKidMode();
                showAllDoneCelebration();
            }
        }

        function showAllDoneCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'completion-celebration';
            celebration.innerHTML = '<div class="celebration-content" style="background: linear-gradient(135deg, #FFD700, #FFA500);">' +
                '<div class="celebration-title">üèÜ ALL DONE! üèÜ</div>' +
                '<h2>üéâ AMAZING JOB! üéâ</h2>' +
                '<h3>‚ú® You completed ALL your chores! ‚ú®</h3>' +
                '<div style="background: rgba(255,255,255,0.9); color: #FF8C00; padding: 15px; border-radius: 15px; margin: 15px 0; font-size: 1.3em; font-weight: bold;">' +
                'üí∞ You earned $4 for chores + $1 BONUS = $5 total! üí∞</div>' +
                '<p>üåü You are a CHORE CHAMPION! üåü</p>' +
                '<button onclick="closeAllDoneCelebration()" style="margin-top: 20px; padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 15px; background: white; color: #FF8C00; cursor: pointer; font-weight: bold;">' +
                'üéä Awesome! üéä</button>' +
                '</div>';
            
            document.body.appendChild(celebration);
            
            setTimeout(function() {
                if (document.body.contains(celebration)) {
                    document.body.removeChild(celebration);
                }
            }, 15000);
        }

        function closeAllDoneCelebration() {
            const celebration = document.querySelector('.completion-celebration');
            if (celebration) {
                document.body.removeChild(celebration);
            }
            // Ensure we're in kid mode after closing celebration
            returnToKidMode();
        }

        function areCoreChoresComplete() {
            // Check if all core chores are kid-completed AND parent-approved
            for (let i = 0; i < choreData.core.length; i++) {
                if (!choreStatus.core[i] || !choreStatus.parentApproval.core[i]) {
                    return false;
                }
            }
            return true;
        }

        function updateProgress() {
            const totalTasks = choreData.core.length + choreData.allowance.length;
            const completedTasks = Object.keys(choreStatus.core).filter(function(key) {
                return choreStatus.core[key];
            }).length + Object.keys(choreStatus.allowance).filter(function(key) {
                return choreStatus.allowance[key];
            }).length;
            
            const percentage = Math.round((completedTasks / totalTasks) * 100);
            
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }

        function showCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            const emojis = ['üéâ', '‚≠ê', 'üåü', 'üéä', 'üëè'];
            celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            document.body.appendChild(celebration);
            
            setTimeout(function() {
                if (document.body.contains(celebration)) {
                    document.body.removeChild(celebration);
                }
            }, 1000);
        }

        function saveData() {
            localStorage.setItem('choreStatus', JSON.stringify(choreStatus));
        }

        function checkForNewDay() {
            const lastDate = localStorage.getItem('lastDate');
            const today = new Date().toDateString();
            
            // Only reset if it's actually a new day (not just chore structure changes)
            if (lastDate && lastDate !== today) {
                console.log('üîÑ New day detected - resetting chores');
                
                // Clear localStorage
                localStorage.removeItem('choreStatus');
                
                choreStatus = {
                    core: {},
                    allowance: {},
                    parentApproval: { core: {}, allowance: {} },
                    bonusTimeGiven: { core: {}, allowance: {} }
                };
                
                timerActive = false;
                timeRemaining = 0;
                parentMode = false;
                allowanceParentMode = false;
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('timerDisplay').style.display = 'none';
                
                saveData();
                renderChores();
                updateProgress();
            }
            
            // Always update the date regardless of reset
            localStorage.setItem('lastDate', today);
        }

        // Initialize app
        initApp();
        checkForNewDay();
        
        // Manual reset function for testing
        window.resetChoreData = function() {
            console.log('Manually resetting all chore data...');
            choreStatus = {
                core: {},
                allowance: {},
                parentApproval: { core: {}, allowance: {} },
                bonusTimeGiven: { core: {}, allowance: {} }
            };
            saveData();
            location.reload();
        };
        
        // Check for new day every minute
        setInterval(checkForNewDay, 60000);
    </script>
</body>
</html>